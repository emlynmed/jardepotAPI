$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});const ruta="/";function verifyCookie(){void 0!==Cookies.get("session")&&""!==Cookies.get("session")||$.ajax({url:ruta+"api/session",type:"GET",dataType:"json",success:function(e){Cookies.set("session",e,{expires:7})},error:function(e){console.log(e)}})}$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip(),getCartProducts()}),$("#search-form").on("keypress",function(e){13==e.which&&$("#search-form").submit()}),$("#search-form").submit(function(e){e.preventDefault();var t=$("#inputSearch").val();window.location=ruta+"busqueda/"+t});var bussy=!1;function ajaxCall(e){bussy?setTimeout(function(){ajaxCall(e)},500):($("#overlay-bussy").addClass("active"),e.data._token=$('meta[name="csrf-token"]').attr("content"),bussy=!0,e.dataType=void 0===e.dataType||null==e.dataType?"text":e.dataType,$.ajax({url:e.url,type:e.type,dataType:e.dataType,data:e.data,success:e.success,error:function(t){$("#overlay-bussy").removeClass("active"),console.log(t),alert("Ocurrio un error "+e.url,"Error")},complete:function(){$("#overlay-bussy").removeClass("active"),"undefined"===(e.complete,!1)&&null==!e.complete&&e.complete(),bussy=!1}}))}function releaseAjaxQueue(){bussy=!1}function blockAjaxQueue(){bussy=!0}function executeAfterAjaxRelease(e){bussy?setTimeout(function(){executeAfterAjaxRelease(e)},500):e()}function getCookie(e){let t="undefined"!=typeof document?document:null;if(t){let o,s=t.cookie.split(";"),a=s.length,n=`${e}=`;for(let e=0;e<a;e+=1)if(0==(o=s[e].replace(/^\s+/g,"")).indexOf(n))return o.substring(n.length,o.length);return""}return""}function deleteCookie(e){this.setCookie(e,"",-1)}function setCookie(e,t,o,s=""){let a="undefined"!=typeof document?document:null;if(a){let n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);let r=`expires=${n.toUTCString()}`,i=s?`; path=${s}`:"";a.cookie=`${e}=${t}; ${r}${i}`}}function verifyAddCartProduct(e,t,o,s){void 0===Cookies.get("session")||""===Cookies.get("session")?$.ajax({url:ruta+"api/session",type:"GET",dataType:"json",success:function(a){Cookies.set("session",a,{expires:7}),addCartProduct(e,t,o,s)},error:function(e){console.log(e)}}):addCartProduct(e,t,o,s)}function addCartProduct(e,t,o,s){var a={productType:e,brand:t,mpn:o};$("#overlay-bussy").addClass("active"),$.ajax({url:ruta+"api/cart/addProduct",type:"POST",dataType:"json",data:{product:JSON.stringify(a),quantity:s,sessionCookie:Cookies.get("session")},success:function(a){"successful"===a.data&&($("#overlay-bussy").removeClass("active"),getCartProducts(),openSnackbar("success","Agregaste "+s+" "+e+" "+t+" "+o))},error:function(e){$("#overlay-bussy").removeClass("active"),console.log(e)}})}function decreaseCartProduct(e,t,o,s){var a={productType:e,brand:t,mpn:o};verifyCookie(),$("#overlay-bussy").addClass("active"),$.ajax({url:ruta+"api/cart/addProduct",type:"POST",dataType:"json",data:{product:JSON.stringify(a),quantity:s,sessionCookie:Cookies.get("session")},success:function(a){"successful"===a.data&&(getCartProducts(),openSnackbar("danger","Quitaste "+(s*=-1)+" "+e+" "+t+" "+o)),$("#overlay-bussy").removeClass("active")},error:function(e){$("#overlay-bussy").removeClass("active")}})}function removeCartProduct(e){void 0!==Cookies.get("session")&&""!==Cookies.get("session")&&($("#overlay-bussy").addClass("active"),$.ajax({url:ruta+"api/cart/removeProduct",type:"DELETE",dataType:"json",data:{product:e,sessionCookie:Cookies.get("session")},success:function(t){"successful"===t.data&&(getCartProducts(),openSnackbar("danger","Eliminaste "+e)),$("#overlay-bussy").removeClass("active")},error:function(e){$("#overlay-bussy").removeClass("active")}}))}function getCartProducts(){if($("#option-dropdown-cart1").hide(),$("#option-dropdown-cart2").hide(),void 0!==Cookies.get("session")&&""!==Cookies.get("session"))$.ajax({url:ruta+"api/cart/products",type:"GET",dataType:"json",data:{sessionCookie:Cookies.get("session")},success:function(e){if(e){var t=JSON.parse(e);makeDropdownCart(t.cart,t.total,t.quantityProducts)}else Cookies.remove("session")},error:function(e){}});else{$("#option-dropdown-cart1").hide(),$("#option-dropdown-cart2").hide(),$("#items-count-nav1").html("0"),$("#products-coun-nav1").html("0 Productos"),$("#items-count-nav2").html("0"),$("#products-coun-nav2").html("0 Productos");var e='<div class="dropdown-item">   <div class="text-muted mt-1">       <span style="white-space: pre-line"><b>No tienes ningún producto en tu carrito.</b></span>   </div></div>';$("#items-card-nav1").html(e),$("#items-card-nav2").html(e)}}function makeDropdownCart(e,t,o){if(o>0){$("#option-dropdown-cart1").show(),$("#option-dropdown-cart2").show(),$("#items-count-nav1").html(o),$("#products-coun-nav1").html(o+" Productos"),$("#items-count-nav2").html(o),$("#products-coun-nav2").html(o+" Productos");var s="";$.each(e,function(e,t){s+=' <div class="dropdown-item">     <div class="row">         <div class="col-10">              <p class="text-muted mat-line" data-toggle="tooltip" title="'+t.name+'">'+t.name+'</p>              <p class="text-muted mat-line">'+t.cartCount+" x "+formatterDolar.format(t.newPrice)+'</p>         </div>         <div class="col-2">             <button class="btn" type="button" data-toggle="tooltip"  title="Eliminar"                   onclick="removeCartProduct(\''+t.name+'\')"><i class="material-icons">close</i></button>         </div>     </div>  </div>'}),s+='   <div class="dropdown-divider"></div><div class="dropdown-item">   <div class="text-muted mt-1"><b>TOTAL: '+formatterDolar.format(t)+'</b></div></div><div class="dropdown-divider"></div>',$("#items-card-nav1").html(s),$("#items-card-nav2").html(s)}else{$("#option-dropdown-cart1").hide(),$("#option-dropdown-cart2").hide(),$("#items-count-nav1").html("0"),$("#products-coun-nav1").html("0 Productos"),$("#items-count-nav2").html("0"),$("#products-coun-nav2").html("0 Productos");s='<div class="dropdown-item">   <div class="text-muted mt-1">       <span style="white-space: pre-line"><b>No tienes ningún producto en tu carrito.</b></span>   </div></div>';$("#items-card-nav1").html(s),$("#items-card-nav2").html(s)}}const formatterDolar=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function openSnackbar(e,t){var o;switch(e){case"success":o="#218838";break;case"warning":o="#f68600";break;case"danger":o="#dc3545";break;case"info":o="#17a2b8";break;case"primary":o="#0069d9";break;default:o="#333"}var s=document.getElementById("snackbar");$("#snackbar").css("background-color",o),$("#snackbar").html("<p>"+t+"</p>"),s.className="show",setTimeout(function(){s.className=s.className.replace("show","")},3e3)}function removeAllProducts(){(void 0!==Cookies.get("session")&&""!==Cookies.get("session")||"undefined"!==Cookies.get("session"))&&$.ajax({url:ruta+"api/cart/removeAllProducts",type:"DELETE",dataType:"json",data:{sessionCookie:Cookies.get("session")},success:function(e){"successful"===e.data&&(getCartProducts(),openSnackbar("success","Se limpió el carrito")),$("#overlay-bussy").removeClass("active")},error:function(e){$("#overlay-bussy").removeClass("active")}})}
