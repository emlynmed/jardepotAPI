var checkPaypal=!1,formPaypal=!1,checkMercado=!1,formMercado=!1,carrito=null;function checkFormPaypal(){formPaypal&&checkPaypal?$("#form-incomplete").css("display","none"):$("#form-incomplete").css("display","block")}function checkFormMercado(){formMercado&&checkMercado?($("#form-incomplete-mp").css("display","none"),$("#form-complete-mp").css("display","block"),$("#btn-mercado-pago").removeAttr("disabled")):($("#form-incomplete-mp").css("display","block"),$("#btn-mercado-pago").attr("disabled"))}function checkRowsProducts(){!$("#table-body").find("tr").length>0?($("#cart-content").removeClass("d-lg-block").addClass("d-none"),$("#no-cart-content").removeClass("d-none").addClass("d-block")):($("#cart-content").removeClass("d-none").addClass("d-lg-block"),$("#no-cart-content").removeClass("d-block").addClass("d-none"))}function calculateTotal(){var t=!0,a=0;if($("#table-body").find("tr").each(function(e,o){if(void 0!==$(o).find(".inventory").val()&&""!==$(o).find(".cart-count").text()){var r=Number($(o).find(".inventory").val()),n=Number($(o).find(".cart-count").text());a=Number(a)+Number($(o).find(".total-row-input").val()),(r<n||!r)&&(t=!1)}}),!1===isNaN(a)&&a<=3e3&&a>0){if(0===$("#trEnvio").length){$("#table-body").append('<tr id="trEnvio"><td><img style="width: 80px;height: 80px;" src="assets/images/productos/--.jpg"></td><td><span style="font-weight: 500;color: #000000">Manejo de Mercancía Envío paquetería</span></td><td>$300.00</td><td class="text-center">1</td><td><span>$300.00</span></td><td></td></tr>')}a+=300}else $("#trEnvio").remove();$("#total-final").text(formatterDolar.format(a)),t?($(".btn-modal-mercado").css("display","block"),$(".btn-modal-paypal").css("display","block")):($(".btn-modal-mercado").css("display","none"),$(".btn-modal-paypal").css("display","none"))}function getCartProductsView(){var t=Cookies.get("session");if(void 0!==t&&""!==t){var a=[];a.url=ruta+"api/cart/products",a.type="get",a.dataType="json",a.data={sessionCookie:t},a.success=function(t){t=JSON.parse(t),$.each(t.cart,function(t,a){var e='<tr><td><img style="width: 80px;height: 80px;"                     src="'+ruta+a.images[0].medium+'"></td><td data-title="Nombre"><a style="font-weight: 500;color: #000000" href="catalogo/'+a.brand.toLowerCase()+"/"+a.productType.toLowerCase()+"-"+a.brand.toLowerCase()+"-"+a.mpn.toLowerCase()+'">'+a.name+'</a></td><td data-title="Precio"> '+formatterDolar.format(a.newPrice)+' <input class="price-product" type="hidden" value="'+a.newPrice+'"></td><td data-title="Cantidad">    <div class="product-controls">        <input type="hidden" class="inventory" value="'+a.inventory+'">        <button class="btn remove-product" onclick="decreaseCartProduct(\''+a.productType+"', '"+a.brand+"', '"+a.mpn+'\', -1)"><i class="material-icons">remove</i></button>        <span class="cart-count">'+a.cartCount+'</span>        <button class="btn add-product" onclick="addCartProduct(\''+a.productType+"', '"+a.brand+"', '"+a.mpn+'\', 1)"><i class="material-icons">add</i></button>    </div></td><td data-title="Total"><span class="total-row">'+formatterDolar.format(a.cartCount*a.newPrice)+'</span> <input class="total-row-input" type="hidden" value="'+a.cartCount*a.newPrice+'"></td><td data-title="          " class="text-center">    <button title="Borrar" class="btn btn-remove-product btn-secondary btn-circle"onclick="removeCartProduct(\''+a.name+"')\">X</button></td></tr>";$("#table-body").append(e)}),checkRowsProducts(),calculateTotal()},ajaxCall(a)}}function createPaypalButton(t,a){$("#paypal-button-container").html(""),paypal.Buttons({createOrder:function(e,o){return o.order.create({purchase_units:[{reference_id:"PAGO-JD",description:"Compra en linea JarDepot",soft_descriptor:"Compra en JarDepot",amount:{currency_code:"MXN",value:a,breakdown:{item_total:{currency_code:"MXN",value:a}}},items:t}]})},onApprove:function(t,a){return a.order.capture().then(function(a){const e=a.purchase_units[0].shipping.name.full_name,o=Object.values(a.purchase_units[0].shipping.address).toString(),r=JSON.stringify({firstName:$("#name-paypal").val(),lastName:$("#lastname-paypal").val(),email:$("#email-paypal").val(),phone:$("#phone-paypal").val()}),n=Cookies.get("session");return window.location=ruta+"c0nf1rm4c10n/p4yp4l/success?orderid="+t.orderID+"&form="+r+"&address="+o+"&name="+e+"&session="+n,!0})}}).render("#paypal-button-container")}$(document).ready(function(){getCartProductsView(),$(document).on("click",".remove-product",function(){var t=$(this).parent(".product-controls").find(".cart-count").text(),a=$(this).parents("tr").find(".price-product").val();if(0===(t=Number(t)-1))$(this).parents("tr").remove(),checkRowsProducts();else{var e=Number(t)*Number(a);$(this).parent(".product-controls").find(".cart-count").text(t),$(this).parents("tr").find(".total-row").text(formatterDolar.format(e)),$(this).parents("tr").find(".total-row-input").val(e)}calculateTotal()}),$(document).on("click",".add-product",function(){var t=$(this).parent(".product-controls").find(".cart-count").text(),a=$(this).parents("tr").find(".price-product").val();t=Number(t)+1;var e=Number(t)*Number(a);$(this).parent(".product-controls").find(".cart-count").text(t),$(this).parents("tr").find(".total-row").text(formatterDolar.format(e)),$(this).parents("tr").find(".total-row-input").val(e),calculateTotal()}),$(document).on("click",".btn-remove-product",function(){$(this).parents("tr").remove(),calculateTotal(),checkRowsProducts()}),$("#remove-all-products").click(function(){removeAllProducts(),$("#table-body").find("tr").remove(),checkRowsProducts()}),$("#terminosPayPal").change(function(){(checkPaypal=$(this).is(":checked"))?$("#text-terms-paypal").css("display","none"):$("#text-terms-paypal").css("display","block"),checkFormPaypal()}),$("#form-paypal input").change(function(){formPaypal=!0,$("#form-paypal input").each(function(){""==$(this).val()&&(formPaypal=!1)}),formPaypal?$("#text-input-paypal").css("display","none"):$("#text-input-paypal").css("display","block"),checkFormPaypal()}),$("#terminosMP").change(function(){(checkMercado=$(this).is(":checked"))?$("#text-terms-mp").css("display","none"):$("#text-terms-mp").css("display","block"),checkFormMercado()}),$("#form-mp input").change(function(){formMercado=!0,$("#form-mp input").each(function(){""==$(this).val()&&(formMercado=!1)}),formMercado?$("#text-input-mp").css("display","none"):$("#text-input-mp").css("display","block"),checkFormMercado()}),$("#btn-mercado-pago").click(function(){var t=Cookies.get("session"),a=[],e=JSON.stringify({firstName:$("#name-mp").val(),lastName:$("#lastname-mp").val(),email:$("#email-mp").val(),phone:$("#phone-mp").val(),state:$("#state-mp").val(),city:$("#city-mp").val(),zip:$("#zip-mp").val(),suburb:$("#suburb-mp").val(),address:$("#address-mp").val()});a.url="https://fasolano.com/jardepotAPI/public/api/checkout/mercadopago",a.type="post",a.dataType="json",a.data={sessionCookie:t,form:e},a.success=function(t){console.log(t),"success"==t.state?window.location=t.data:alert("Ocurrio un error al generar el link de pago, comunicate con nostros para más información")},ajaxCall(a)}),$(".btn-modal-paypal").click(function(){$("#form-paypal input").change(),$("#terminosPayPal").change();var t=Cookies.get("session"),a=[];a.url=ruta+"api/cart/products",a.type="get",a.dataType="json",a.data={sessionCookie:t},a.success=function(t){let a=[],e=0;t=JSON.parse(t),$.each(t.cart,function(t,o){let r=o.newPrice;r=Number(r.toFixed(2)),a.push({name:o.name,unit_amount:{currency_code:"MXN",value:r},quantity:o.cartCount}),e+=r*o.cartCount}),e<3e3&&(e+=300,a.push({name:"Costo de envio",unit_amount:{currency_code:"MXN",value:"300.00"},quantity:"1"})),createPaypalButton(a,e)},ajaxCall(a)}),$("#form-incomplete").click(function(){alert("Completa todos los campos y acepta terminos y condiciones, por favor")})});
